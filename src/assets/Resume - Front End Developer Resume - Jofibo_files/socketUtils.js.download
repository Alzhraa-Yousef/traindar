(function(){function t(a){try{if(e=a,!n){n=!0;try{a="https://realtime.getbeamer.com/?product="+_productId,"undefined"!==typeof e&&""!==e&&(a+="&user="+encodeURIComponent(e)),g=("object"==typeof exports&&"function"==typeof exports.io?exports.io:window.io)(a,{reconnectionDelay:12E4,reconnectionDelayMax:6E5,reconnectionAttempts:5,randomizationFactor:.8,transports:["websocket"]}),g.on("update",function(b){var c=!1;if("string"===typeof b||b instanceof String){var d=b.split(":");1<d.length&&(b=parseInt(d[0]),c="immediate"===d[1])}b>p&&(p=b,b="updatesAvailable",c&&(b+=":"+JSON.stringify({immediate:!0})),window.parent.postMessage(b,"*"))}),g.on("reconnect_failed",function(){l();m()})}catch(b){q(b),l(),m()}}}catch(b){q(b),l(),m()}}function l(){"undefined"!==typeof g&&(g.disconnect(),delete g)}function m(a){window.parent.postMessage("prepareAutoRefresh","*")}function q(a){try{var b="undefined"!==typeof a.stack?a.stack:"undefined"!==typeof a.toString?a.toString():a.message}catch(d){b=a.message}a=(new Date).getTime();var c="https://functions.getbeamer.com/log?error="+encodeURIComponent(b);c+="&productId="+encodeURIComponent(_productId);"undefined"!==typeof e&&""!==e&&(c+="&userId="+encodeURIComponent(e));lastError={error:b,time:a};r(c,null,null,"POST")}function r(a,b,c,d,f){"undefined"===typeof f&&(f=0);if("undefined"===typeof d||""===d.trim())d="GET";if("POST"===d&&0<a.indexOf("?")){var k=a.split("?");a=k[0];k=k[1]}var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==this.readyState)if(200==this.status)"undefined"!==typeof b&&b&&b(this.responseText);else if(400>this.status||403<this.status)5>f?setTimeout(function(){r(a,b,c,d,f)},6E4*f):"undefined"!==typeof c&&c&&c(this.responseText)};h.crossDomain=!0;h.open(d,a,!0);h.withCredentials=!1;"POST"===d&&k&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");h.send(k);f++}var p=(new Date).getTime(),g,e,n=!1;(function(){window.addEventListener("message",function(a){if(a.data&&"string"===typeof a.data&&"{"!==a.data[0]&&-1<a.data.indexOf(":"))try{var b=a.data.indexOf(":");var c=a.data.substring(0,b);var d=a.data.substr(b+1)}catch(f){return}else c=a.data;"initUpdatesListener"==c?t(d):"stopUpdatesListener"==c&&l()},!1)})()})();